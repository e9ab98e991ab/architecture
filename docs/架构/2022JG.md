## 第1章 绪论

### 1.1 系统架构概述

>系统架构设计师是承担系统架构设计的核心角色，他不仅是连接用户需求和系统进一步设计与实现的桥梁，也是系统开发 早期阶段质量保证的关键角色。随着系统规模和复杂性的提升，系统架构设计师在整个项目研
制中的主导地位愈加重要。可以说，系统架构师就是项目的总设计师，他是一个既需要掌控整体又需要洞悉局部瓶颈，并依据具体的业务场景给出解决方案的总体设计人员：他要确认和评
估系统需求，给出开发规范，搭建系统实现的核心构架，并澄清技术细节、扫清主要难点的技术人员：他要掌握技术团队的能力需要，给出项目管理方法，采用合适生命周期模型，具备以
自身为核心形成团队的能力，并在项目进度计划和经费分配等方面开展评估，以预防项目风险。

系统架构(System Architecture)是系统的一种整体的高层次的结构表示， 是系统的骨架和根基，也决定了系统的健壮性和生命周期的长短。
### 1.1.1 系统架构的定义及发展历程

#### 1.系统架构的定义

**架构**是体现在组件中的一个系统的基本组织、它们彼此的关系与环境的关系及指导它的设 计和发展的原则。
**系统**是组织起来完成某一特定功能或一组功能的组件集。
> 系统这个术语包括了单独的应用程序、传统意义上的系统、子系统、系统之系统、产品线、整个企业及感兴趣的其他集合。系 统用于完成其环境中的一个或多个任务。

**环境**或者上下文决定了对这个系统的开发、运作、政策以及会对系统造成其他影响的环境和设置。
**任务**是由一个或者多个利益相关者通过系统达到一些目标的系统的一个用途或操作。

架构设计的**作用**主要包括以下几点：
* 解决相对复杂的需求分析问题：
* 解决非功能属性在系统占据重要位置的设计问题：
* 解决生命周期长、扩展性需求高的系统整体结构问题：
* 解决系统基于组件需要的集成问题：
* 解决业务流程再造难的问题。

#### 2. 发展历程

软件架构运用而生的条件：

(1)软件复杂、易变，其行为特征难以预见，软件开发过程中需求和设计之间缺乏有效的转换，导致软件开发过程困难和不可控。
(2)随着软件系统的规模越来越大、越来越复杂，整个系统的结构和规格说明就显得越来越重要。
(3)对于大规模的复杂软件系统，相较于对计算算法和数据结构的选择，系统的整体结构设计和规格说明已经变得明显重要得多。
(4)对软件系统结构的深入研究将会成为提高软件生产率和解决软件维护问题的最有希望的新途径。

##### 软件架构的四个发展阶段：

1)基础研究阶段(1968一1994年)

**模块化开发方法**是指把一个待开发的软件分解成若干个小的而且简单的部分，采用对复杂事物分而治之的经典原则。

模块化开发方法涉及的主要问题是模块设计的规则，即系统如何分解成模块。

而每一模块都可独立开发与测试，最后再组装成一个完整软件。

对一个规约进行分解，以得到模块系统结构的方法有数据结构设计法、功能分解法、数据流设计和面向对象的设计等。

#####  将系统分解成模块时，应该遵循以下规则：
(1)最高模块内聚。也就是在一个模块内部的元素最大限度地关联，只实现一种功能的模块是高内聚的，具有三种以上功能的模块则是低内聚的。
(2)最低耦合。也就是不同模块之间的关系尽可能弱，以利于软件的升级和扩展。
(3)模块大小适度。颗粒过大会造成模块内部维护困难，而颗粒过小又会导致模块间的耦合增加。
(4)模块调用链的深度（嵌套层次）不可过多。
(5)接口简单、精炼（扇入扇出数不宜太大），具有信息隐蔽能力。
(6)尽可能地复用已有模块。

#####  基于模块化思想，业界提出了面向对象服务架构(Service-Oriented Architecture,SOA)思想

它提供一组基于标准的方法和技术，通过有效整合和重用现有的应用系统和各种资源实现服务组件化，并基于服务组件实现各种新业务应用的快速组装，帮助企业更好地应对业务的灵活性要求。

这样，通过有效平衡业务的灵活性和IT的复杂度，为开发者提供了新的视角，有效拉近了IT和业务的距离。到20世纪90年代末期，计算机的发展推动了企业管理自动化的步伐，管理信息系统(Management Information System,MIS)在企业中得到了广泛使用。

与此同时，IT业为了降低开发成本，解决业务需求的易变性，实现软件模块的重用，考虑将企业业务与数据处理相分离的分层思想，这也是软件架构的初步雏形。
如下图：

![image-20230208下午22159836](https://cdn.jsdelivr.net/gh/e9ab98e991ab/architecture@assets/assets/image-20230208%E4%B8%8B%E5%8D%8822159836.png)

2)概念体系和核心技术形成阶段(1999一2000年)

组件具有可组装性和可插拔性。

每个组件的运行仅依赖于平台或者容器，组件与组件之间不存在直接的耦合关系。同时，组件和组件之间又并非绝对独立。

组件经过组装后可以与其他组件进行业务上的交互。组件化开发并不等同于模块化开发。模块化开发只是在逻辑上做了切分，物理上（代码）通常并没有真正意义上的隔离。

组件化也不等同于应用集成，应用集成是将一些基于不同平台或不同方案的应用软件有机地集成到一个无缝的、并列的、易于访问的单一系统中，以建立一个统一的综合应用。

**组件化比模块化更独立，但比应用集成结合得更加紧密。**

3)理论体系完善与发展阶段(1996年至今)

(1)软件架构描述与表示。
目前存在多种软件架构描述语言，比较典型的是基于组件和消息的软件架构描述语言C2SADL,分布、并发类型的架构描述语言Wright，架构互换语言ACME，基于组件和连接的架构描述语言UniCon，基于事件的架构描述语言Rapide，以及其他比较有影响力的描述语言Darwin、MetaH、Aesop、Weaves、SADL、xADL等。

(2)软件架构分析、设计和测试。
**架构分析**的内容可分为结构分析、功能分析和非功能分析。

分析的目的是系统被实际构造之前预测其质量属性。
架构分析常用的方法有：

软件架构分析方法SAAM、架构权衡分析法ATAM、成本效益分析法CBAM、基于场景的架构再工程SBAR、架构层次的软件可维护性预测ALPSM、软件架构评估模型SAEM等。

**架构设计**是指生成一个满足用户需求的软件架构过程。

架构设计常用的方法有：

从工件描述中提取架构描述的工件驱动(artifact--driven)方法；

从用例导出架构抽象的用例驱动(use-case-driven):

从模式导出架构抽象的模式驱动(pattern-driven)方法；

从领域模型导出架构抽象的域驱动(domain-driven)方法以及从设计过程中获得架构质量属性需求的属性驱动设计(attribute-driven design)方法等。
**架构测试**着重于仿真系统模型、解决架构层的主要问题。

由于测试的抽象层次不同，架构测试策略分为单元、子系统、集成和验收测试等阶段的测试策略。测试方法主要包括架构测试覆盖方法、组件设计正确性验证方法和基于CHAM的架构动态语义验证方法等。

(3)软件架构发现、演化与重用。

**软件架构发现**解决如何从已经存在的系统中提取软件架构的问题，属于逆向工程。

Waters等人提出了一种迭代式架构发现过程。
**软件架构演化**即由于系统需求、技术、环境和分布等因素的变化而最终导致软件架构的变动。软件系统在运行时刻的架构变化称为架构动态性，而将架构的静态修改称为架构扩展。架构扩展和动态性都是架构适应性和演化的研究范畴。
**软件架构复用属于设计重用**，比代码重用更抽象。架构模式就是架构复用的一种成果。

(4)基于软件架构的开发方法。
软件开发模型是跨越整个软件生存周期的系统开发、运行和维护所实施的全部工作和任务的结构框架，给出了软件开发活动各个阶段之间的关系。

通常软件开发模型可分为三种：

以软件需求完全确认为前提的瀑布模型：

在软件开发初期只能提供基本需求为前提的渐进式开发模型（如螺旋模型等）：

以形式化开发方法为基础的变换模型。

(5)软件架构风格。
**架构风格（架构模式）**是针对给定场景中经常出现的问题提供的一般性可重用方案，它反映了领域中众多系统所共有的结构和语义特征，并指导如何将各个模块和子系统有效地组成一个完整的系统。

通常，将软件架构风格分成主要五类(David Garland和Mary Shaw划分方式)：
**数据流风格、调用/返回风格、独立组件风格、虚拟机风格和仓库风格**。

4)普及应用阶段（2000年至今)

>在软件架构的发展历程中，**1999年是一个关键年份**。
>
>这一年召开了第一届FP软件架构会议，并成立了IFIP工作组2.0与全球软件架构师协会。
>
>许多企业开始将软件架构相关理论投入实践，为了使架构描述能够在实践中得到更广泛的应用，Open Group提出了ADML,它是一种基于XML的架构描述语言，支持广泛的架构模型共享。
>
>由于企业对重用以及产品族的形成有着更多考虑，因此，软件产品线成为软件架构的一个重要分支，吸引了大量大型企业的关注。
>软件产品线架构表示一组具有公共的系统需求集的软件系统，它们都是根据基本的用户需求对
>标准的产品线架构进行定制，将可重用组件与系统独立的部分集成而得到的。

软件架构是软件生命周期中的重要产物，它影响软件开发的各个阶段：

* **需求阶段：**把软件架构有的概念引入需求分析阶段，有助于保证需求规约和系统设计之
  间的可追踪性和一致性。
* **设计阶段：**设计阶段是软件架构研究关注最早、最多的阶段，这一阶段的软件架构主要
  包括软件架构的描述、软件架构模型的设计与分析以及对软件架构设计经验的总结与复
  用等。
* **实现阶段：**将设计阶段设计的算法及数据类型用程序设计语言进行表示，满足设计、架
  构和需求分析的要求，从而得到满足设计需求的目标系统。
* 维护阶段：为了保证软件具有良好的维护性，在软件架构中针对维护性目标进行分析
  时，需要对一些有关维护性的属性（如可扩展性、可替换性）进行规定，当架构经过
  定的开发过程实现和形成软件系统时，这些属性也相应地反映了软件的维护性。

纵观软件架构的发展历程，其完成了由实践上升到理论，再由理论反馈指导实践的过程，
理论与实践均处于健康发展中，己经形成良性发展循环。
架构设计师也是随着架构概念的不断演化而逐步发展为软件开发过程中一个非常重要的
角色。

### 1.1.2 软件架构的常用分类及建模方法
#### 1.软件架构的常用分类

多年来，“架构”概念经过不断演化，目前已形成了满足不同用途的架构模式，比较典型的架构模型包括**分层架构、事件驱动架构、微核架构、微服务架构和云架构**等五类。

当然，像**C/S、B/S、管道-过滤器和PAC等架构**也是被广泛使用的软件架构，本节简要说明典型架构内涵。

##### 1)分层架构

分层架构(Layered Architecture)是最常见的软件架构，也是事实上的标准架构。这种架构将软件分成若干个水平层，每一层都有清晰的角色和分工，不需要知道其他层的细节。

层与层之间通过**接口**进行通信。分层架构通常明确约定软件一定要分成多少层。

最常见的是四层结构，

* 表现层(Presentation Layer):用户界面，负责视觉和用户互动：
* 业务层(Business Layer):实现业务逻辑；
* 持久层(Persistence Layer):提供数据，SQL语句就放在这一层；
* 数据库(Database Layer).:保存数据。

![image-20230208下午25258152](https://cdn.jsdelivr.net/gh/e9ab98e991ab/architecture@assets/assets/image-20230208%E4%B8%8B%E5%8D%8825258152.png)

有的项目在逻辑层和持久层之间加了一个服务层(Service)，提供不同业务逻辑需要的一些通用接口。用户的请求将依次通过这四层的处理，不能跳过其中任何一层。

##### 2)事件驱动架构
事件(Event)是状态发生变化时软件发出的通知。事件驱动架构(Event-driven Architecture)
是通过事件进行通信的软件架构，它分成四个部分：

* 事件队列(Event Queue)：接收事件的入口：
* 分发器(Event Mediator):将不同的事件分发到不同的业务逻辑单元：
* 事件通道(Event Channel).：分发器与处理器之间的联系渠道；
* 事件处理器(Event Processor):实现业务逻辑，处理完成后会发出事件，触发下一步
  操作。

![image-20230208下午30521640](https://cdn.jsdelivr.net/gh/e9ab98e991ab/architecture@assets/assets/image-20230208%E4%B8%8B%E5%8D%8830521640.png)

对于简单的项目，事件队列、分发器和事件通道可以合为一体，整个软件就分成事件代理
和事件处理器两部分。

##### 3)微核架构

**微核架构**(Microkernel Architecture)又称为**插件架构**(Plug-in Architecture)，是指软件的内核相对较小，主要功能和业务逻辑都通过插件实现：

![image-20230208下午33242154](https://cdn.jsdelivr.net/gh/e9ab98e991ab/architecture@assets/assets/image-20230208%E4%B8%8B%E5%8D%8833242154.png)
**内核(Coe)**通常只包含系统运行的最小功能。

插件则是互相独立的，插件之间的通信应该减少到最低，避免出现互相依赖的问题。

##### 4)微服务架构
微服务架构(Microservices Architecture)是服务导向架构(Service-Oriented Architecture,SOA)
的升级。

每一个服务就是一个独立的部署单元(Separately Deployed Unit)。

这些单元都是分布式的，互相解耦，通过远程通信协议（比如REST、SOAP)联系：

![image-20230208下午33453804](https://cdn.jsdelivr.net/gh/e9ab98e991ab/architecture@assets/assets/image-20230208%E4%B8%8B%E5%8D%8833453804.png)
